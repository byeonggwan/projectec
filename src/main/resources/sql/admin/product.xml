<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.ecommerce.projectec.product.ProductMapper">
    <insert id="insert" parameterType="HashMap" useGeneratedKeys="true" keyProperty="PRODUCT_ID">
        INSERT INTO PRODUCT(CATEGORY_ID, PRODUCT_NAME, PRODUCT_PRICE, PRODUCT_STOCK, PRODUCT_DESC, PRODUCT_DISCOUNT)
        SELECT CATEGORY_ID, #{PRODUCT_NAME}, #{PRODUCT_PRICE}, #{PRODUCT_STOCK}, #{PRODUCT_DESC}, #{PRODUCT_DISCOUNT}
        FROM CATEGORY
        WHERE CATEGORY_NAME = #{CATEGORY_NAME}
    </insert>
    <select id="selectById" resultType="HashMap" parameterType="Int">
    </select>
    <!--category와 status를 받아서 동적쿼리로 결과를 반환. 보안상 약점있는지 확인 필요-->
    <select id="selectByCatAndStat" resultType="HashMap">
        SELECT *
        FROM PRODUCT P
            JOIN CATEGORY C
            ON P.CATEGORY_ID = C.CATEGORY_ID
        <where>
            <if test="CATEGORY_ID != null">
                AND P.CATEGORY_ID = #{CATEGORY_ID}
            </if>
            <if test="STATUS != null">
                AND P.PRODUCT_STATUS = #{STATUS}
            </if>
        </where>
        ORDER BY PRODUCT_CREATED_AT DESC
    </select>
    <select id="selectCategory" resultType="HashMap">
        SELECT *
        FROM CATEGORY
        ORDER BY CATEGORY_ID ASC
    </select>

    <update id="updateStatById" parameterType="HashMap">
        UPDATE PRODUCT
        SET PRODUCT_STATUS=#{PRODUCT_STATUS}
        WHERE PRODUCT_ID = #{PRODUCT_ID}
    </update>
</mapper>